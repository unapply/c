<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mobile-friendly Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            max-width: 500px;
        }

        form {
            margin-bottom: 20px;
        }

        input, select {
            margin-bottom: 10px;
            width: 100%; /* Adjusted width for two inputs in one line */
            padding: 10px;
            box-sizing: border-box;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        h1 {
            margin-top: 20px;
            font-size: 20px;
        }

        /* Media Query for Mobile View */
        @media only screen and (max-width: 600px) {
            input[type="number"],
            input[type="submit"],
            select {
                width: 100%; /* Full width for small screens */
            }

            form {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }

            input[type="submit"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<strong>Create:</strong>
<form onsubmit="return generate(this);">
    <input name="month" id="month" placeholder="month" type="number" />
    <input name="year" id="year" placeholder="year" type="number" />
    <input name="source" id="source" placeholder="source" onkeyup="this.value = this.value.toLowerCase()" autofocus />
    <select name="style">
        <option value="aa">Select Style</option>
    </select>
    <input name="price" id="price" placeholder="price" type="number" />
    <input type="submit">
</form>

<br>
<h1 id="barcode"></h1>
<br>
<strong>From Existing:</strong>
<form onsubmit="return decode(this);">
    <input name="oldcode" placeholder="code" onkeyup="this.value = this.value.toLowerCase()" />
    <input name="date" placeholder="small code" type="number" />
    <select name="style">
        <option value="aa">Select Style</option>
    </select>
    <input type="submit" />
</form>

</body>
<script>
    // Get current date
    const currentDate = new Date();

    // Fill month input with current month
    document.getElementById('month').value = ('0' + (currentDate.getMonth() + 1)).slice(-2);

    // Fill year input with current year
    document.getElementById('year').value = String(currentDate.getFullYear()).slice(-2);
</script>
<script>
    let styles = {
        "Shirts": ["sh", "si"],
        "Suits": ["su", "st"],
        "Sharara": ["sr", "sa"],
        "Nayra": ["ny", "na"],
        "Paplam": ["pa", "pl"],
        "Skirt": ["sk"],
        "Kurti": ["ku", "kt"],
        "CropTop": ["ct", "cr"],
        "Palazzo": ["pl", "pz", "pa"],
        "FrontCutSkirt": ["fc", "fs", "fk"],
        "DhotiSet": ["ds", "dh"],
        "Gown": ["go", "gw"],
        "StraightSuit": ["ss", "sg"],
        "FrockSuit": ["fr", "fo"],
        "WrapSaree": ["ws", "ws"],
        "LongMidi": ["lm", "li"],
        "ShortMidi": ["sm", "si"],
        "Jeans": ["je", "ja"],
        "Lower": ["lo", "lw"],
        "NightSuit": ["ns", "ni"],
        "Nighty": ["ng", "nt"],
        "TShirt": ["ts", "ti", "th"],
        "Top": ["to", "tp"],
        "Leggings": ["le", "lg"],
        "LeggingPants": ["lp", "li"]
    };

    function fillStyles() {
        // Get all select elements with name="style"
        let selects = document.querySelectorAll('select[name="style"]');

        // Loop through each select element and populate with options
        selects.forEach(select => {
            // Loop through the styles object and add options
            for (let key in styles) {
                if (styles.hasOwnProperty(key)) {
                    // Create an option element
                    let option = document.createElement('option');

                    // Set the value and text of the option
                    option.value = key;
                    option.text = key;

                    // Append the option to the select element
                    select.appendChild(option);
                }
            }
        })
    }

    fillStyles()

    function decode(form) {
        let date = splitDate(form.date.value);
        let oldcode = form.oldcode.value;
        let code = splitOldCodeFormat1(oldcode)
        let price = code.beginPrice + code.endPrice;
        // alert("price is: " + price + " of " + oldcode)
        let source = code.source;
        let style = form.style.value;

        generateBarcode(date.month, date.year, price, source, style)

        return false;
    }

    function splitDate(inputString) {
        var year, month;

        if (inputString.length !== 4 && inputString.length !== 5) {
            return { month: Math.floor(Math.random() * 9) + 1 };
        }

        // Extract year from the first character
        year = parseInt(inputString.charAt(0)) + 20;

        // Extract month from the last character(s)
        var lastChar = inputString.charAt(inputString.length - 1);
        if (lastChar >= '3' && lastChar <= '9') {
            // Last character is from '3' to '9', so month is the last character only
            month = lastChar;
        } else if (lastChar >= '0' && lastChar <= '2') {
            // Last character is from '0' to '2', so month consists of the last two characters
            month = inputString.slice(-2);
        } else {
            return "Error: Invalid month";
        }

        return { year: year, month: month };
    }

    function splitOldCodeFormat1(inputString) {
        var endPrice, source, beginPrice;

        if (inputString.length > 9) {
            return "Error: String length should not exceed 9 characters";
        } else if (inputString.length >= 7) {
            // EndPrice: Last 2 characters
            endPrice = inputString.slice(-2);

            // Source: Last 4th and 3th characters
            source = inputString.slice(-4, -2);

            // BeginPrice: First 2 characters if total string length is 7 or 8
            //               or 3 characters if string length is 9
            if (inputString.length === 9) {
                beginPrice = transformString(inputString.slice(0, 3));
            } else {
                beginPrice = transformString(inputString.slice(0, 2));
            }
        } else {
            return "Error: String length should be at least 7 characters";
        }

        return { endPrice, source, beginPrice };
    }

    function transformString(inputString) {
        var result = '';

        var oddCharacterMapping = {
            1: 4,
            2: 5,
            3: 6,
            4: 7,
            5: 8,
            6: 9,
            7: 0,
            8: 1,
            9: 2,
            0: 3
        };

        var evenCharacterMapping = {
            1: 8,
            2: 9,
            3: 0,
            4: 1,
            5: 2,
            6: 3,
            7: 4,
            8: 5,
            9: 6,
            0: 7
        };

        for (var i = 0; i < inputString.length; i++) {
            var char = inputString.charAt(i);

            // Check if the index is odd or even
            if (i % 2 === 0) { // Even index characters
                if (char in evenCharacterMapping) {
                    result += evenCharacterMapping[char];
                }
                // alert("even " + evenCharacterMapping[char] + " for " + char)
            } else { // Odd index characters
                if (char in oddCharacterMapping) {
                    result += oddCharacterMapping[char];
                }
                // alert("odd " + evenCharacterMapping[char] + " for " + char)
            }
        }

        return result;
    }

    function generate(form) {
        let month = form.month.value;
        let year = form.year.value;
        let price = form.price.value;
        let source = form.source.value;
        let style = form.style.value;

        return generateBarcode(month, year, price, source, style)
    }

    function generateBarcode(month, year, price, source, style) {
        let barcode = ""

        barcode += getYearCode(year) + getMonthCode(month)

        // Split the price into two parts: first part and last two characters
        var firstPart = price.slice(0, -2);
        var secondPart = price.slice(-2);

        // Strings to hold the output of each loop
        var firstPartOutput = "";
        var secondPartOutput = "";

        // Iterate over each character in the first part
        for (var i = 0; i < firstPart.length; i++) {
            firstPartOutput += getPriceCode(firstPart.charAt(i));
        }

        // Iterate over each character in the second part
        for (var j = 0; j < secondPart.length; j++) {
            secondPartOutput += getPriceCode(secondPart.charAt(j));
        }

        let sourceCode = generateSourceCode(source);
        let styleCode = styles[style][Math.floor(Math.random() * styles[style].length)];
        let stylePart1 = styleCode.charAt(0); // or style[0]
        let stylePart2 = styleCode.charAt(1); // or style[1]

        barcode += firstPartOutput + stylePart1 + sourceCode + secondPartOutput + stylePart2

        document.getElementById("barcode").innerText = barcode
        return false
    }

    function generateSourceCode(inputString) {
        // Generate a random number between 2 to 9
        var randomNum = Math.floor(Math.random() * 8) + 2;
        var result = '';

        // Iterate over each character in the input string
        for (var i = 0; i < inputString.length; i++) {
            var charCode = inputString.charCodeAt(i);

            // Subtract the random number from the character code
            var newCharCode = charCode - randomNum;

            // If the new character code goes below 'a', loop back to 'z'
            if (newCharCode < 97) {
                // console.log("did some changes here, previous: " + newCharCode)
                newCharCode = 122 - (96 - newCharCode);
                // console.log("new one: " + newCharCode)
            }

            // Convert the new character code to its corresponding character
            var newChar = String.fromCharCode(newCharCode);

            // console.log("random: " + randomNum + "  old character code: " + charCode + " or " + String.fromCharCode(charCode) + " new characode: " + newCharCode + " or " + String.fromCharCode(newCharCode));

            // Append the new character to the result
            result += newChar;
        }

        // Prepend the result with the random number
        result = randomNum + result;

        return result;
    }

    function getPriceCode(numberString) {
        var mapping = {
            1: ["p"],
            2: ["a", "b", "c"],
            3: ["d", "e", "f"],
            4: ["g", "h", "i"],
            5: ["j", "k", "l"],
            6: ["m", "n", "o"],
            7: ["q", "r", "s"],
            8: ["t", "u", "v"],
            9: ["x", "y", "z"],
            0: ["w"]
        }
        let number = parseInt(numberString)
        // Get the array corresponding to the given number
        var array = mapping[number];

        // Check if the array exists and has elements
        if (array && array.length > 0) {
            // Generate a random index within the range of the array length
            var randomIndex = Math.floor(Math.random() * array.length);
            // Return the randomly selected value from the array
            let result = array[randomIndex];
            return result;
        } else {
            // Return null if the array is empty or doesn't exist
            alert("invalid price code")
            return "!";
        }
    }

    function getYearCode(numberString) {
        var mapping = {
            23: ["d", "e", "f"],
            24: ["g", "h", "i"],
            25: ["j", "k", "l"],
            26: ["m", "n", "o"],
            27: ["q", "r", "s"],
            28: ["t", "u", "v"],
            29: ["x", "y", "z"],
            0: ["a", "b", "c", "p", "w"]
        }
        let number = parseInt(numberString)
        // Get the array corresponding to the given number
        if (number >= 23 && number <= 29) {
            var array = mapping[number];
        } else {
            var array = mapping[0];
        }

        // Check if the array exists and has elements
        if (array && array.length > 0) {
            // Generate a random index within the range of the array length
            var randomIndex = Math.floor(Math.random() * array.length);
            // Return the randomly selected value from the array
            return array[randomIndex];
        } else {
            // Return null if the array is empty or doesn't exist
            alert("invalid year")
            return "!";
        }
    }

    function getMonthCode(numberString) {
        var mapping = {
            1: ["p"],
            2: ["c"],
            3: ["d", "e", "f"],
            4: ["g", "h", "i"],
            5: ["j", "k", "l"],
            6: ["m", "n", "o"],
            7: ["q", "r", "s"],
            8: ["t", "u", "v"],
            9: ["x", "y", "z"],
            10: ["w"],
            11: ["a"],
            12: ["b"]
        }
        // Get the array corresponding to the given number
        let number = parseInt(numberString);
        var array = mapping[number];

        // Check if the array exists and has elements
        if (array && array.length > 0) {
            // Generate a random index within the range of the array length
            var randomIndex = Math.floor(Math.random() * array.length);
            // Return the randomly selected value from the array
            return array[randomIndex];
        } else {
            // Return null if the array is empty or doesn't exist
            alert("invalid month")
            return "!";
        }
    }

    function generateRandomLowerCaseLetter() {
        var charCode;
        charCode = Math.floor(Math.random() * 26) + 97;
        return String.fromCharCode(charCode);
    }
</script>
</body>
</html>
